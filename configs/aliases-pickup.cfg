// =============================================
// alias definitions for server setup and voting
// =============================================

alias do_endmatch_1 "endmatch"
alias do_endmatch_0 "echo NOTE: Still initializing, not ending match"
//alias do_endmatch "do_endmatch_${_done_initializing}"
// mod by bfg
alias do_endmatch "do_endmatch_bfg_custom; do_endmatch_0"

alias do_endmatch_bfg_custom "g_maplist \"\"; g_maxplayers 16; maxplayers 16"

alias do_restart_1 "restart"
alias do_restart_0 "echo NOTE: Still initializing, not restarting match"
alias do_restart "do_restart_${_done_initializing}"

// ========
// maplists
// ========

set _maplist_default ""
set _maplist_duel "fuse bloodrun_a3 finalrage silentsiege stormkeep toxicity warfare hub3aeroq3a_nex_r4 downer_final_r1 sinister_full_r1 xoylent crystalcave-r04 imprisoned-final_r3 opium_v4 ruinerx darkzone aggressorx fe26"
set _maplist_nb "indoor_volleyball_v1r7 nb_nightball slimeball_v1r3 nb_cybervolley_v1r2 pb_revmisc1_v1r3 space_v1r2 parkball_v1r1 nb_indoor_basketball_v1r4 indoor_handball_v1r4 indoor_football_v1r4 farm_v1r3 nexball_succer_socks_v1r3 nexballarena pipe_v1r3 soccer2_v1r3 secondstage aerial-match nb_bumperPool_cl nb_bumperPool_md basket_case swat-sd marsball mayanball nb_challenge1_v1r2 rocknball_v1r2 gears_n_balls_v1_r3 slope_v1r1 poolparty_v1r3 footballbacon_v1r2 footballeggs_v1r1 gforce_soccer_v1r3 vacuum_v1r2 the_dome_v1r3 bloodball rink_nexball_v1r4 dustball ariel nb_aina_stadium_x97_v1r2 crossing_nexball nb_bumperPool_4t eeeepic_v1r1 duodecuple_v1r3 ballz courtfun dearbumperball deardrugball"
set _maplist_as "techassault"

alias addmap "addmap_${* ?}"
alias addmap_ "fs_rescan; g_maplist \"\""
alias addmap_duel "fs_rescan; addtolist _maplist_duel ${2}"
alias addmap_nb "fs_rescan; addtolist _maplist_nb ${2}"
alias addmap_as "fs_rescan; addtolist _maplist_as ${2}"

// ==============
// gametype rules
// ==============

alias _balance_xonotic   "exec balance-xonotic.cfg"
alias _physics_xonotic   "exec physicsX.cfg"

// default gameplay settings
alias _defaultteams     "g_ca_teams_override 0; g_freezetag_teams_override 0; g_keyhunt_teams_override 0; g_tdm_teams_override 0"
alias _defaultlimits    "capturelimit_override -1; fraglimit_override -1; leadlimit_override 0; timelimit_override 20"
alias defaultsettings   "_nomutators; _defaultteams; _defaultlimits; enablebots; g_maxplayers 0; g_powerups -1; sv_taunt 1; teamplay_mode 4; g_maplist \"$_maplist_default\""

// gametype rules
alias as-rules          "gametype as;	_maplist \"$g_maplist_as\""
alias ca-rules          "gametype ca;	g_powerups 0; teamplay_mode 1"
alias ctf-rules         "gametype ctf;	fraglimit_override 10"
alias dm-rules          "gametype dm"
alias dom-rules         "gametype dom"
alias ft-rules          "gametype ft; 	g_powerups 0"
alias ka-rules          "gametype ka;	g_keepaway_ballcarrier_highspeed 1.5; g_keepaway_score_bckill 3; g_keepaway_score_killac 5; g_keepaway_score_timepoints 1; _weaponarena"
alias kh-rules          "gametype kh"
alias lms-rules         "gametype lms;	g_powerups 0; teamplay_mode 1"
alias nb-rules          "gametype nb;	g_maplist \"$_maplist_nb\""
alias ons-rules         "gametype ons"
alias tdm-rules         "gametype tdm"

// ============
// vote aliases
// ============

alias as     "defaultsettings; as-rules;    do_endmatch"
alias ca     "defaultsettings; ca-rules;    do_endmatch"
alias ctf    "defaultsettings; ctf-rules;   do_endmatch"
alias dm     "defaultsettings; dm-rules;    do_endmatch"
alias duel   "defaultsettings; duel-rules;  do_endmatch"
alias dom    "defaultsettings; dom-rules;   do_endmatch"
alias ft     "defaultsettings; ft-rules;    do_endmatch"
alias ka     "defaultsettings; ka-rules;    do_endmatch"
alias kh     "defaultsettings; kh-rules;    do_endmatch"
alias lms    "defaultsettings; lms-rules;   do_endmatch"
alias nb     "defaultsettings; nb-rules;    do_endmatch"
alias ons    "defaultsettings; ons-rules;   do_endmatch"
alias tdm    "defaultsettings; tdm-rules;   do_endmatch"

alias ca3   "defaultsettings; ca-rules;  g_ca_teams_override 3;         do_endmatch"
alias ca4   "defaultsettings; ca-rules;  g_ca_teams_override 4;         do_endmatch"
alias ft3   "defaultsettings; ft-rules;  g_freezetag_teams_override 3;  do_endmatch"
alias ft4   "defaultsettings; ft-rules;  g_freezetag_teams_override 4;  do_endmatch"
alias kh2   "defaultsettings; kh-rules;  g_keyhunt_teams_override 2;    do_endmatch"
alias kh4   "defaultsettings; kh-rules;  g_keyhunt_teams_override 4;    do_endmatch"
alias tdm3  "defaultsettings; tdm-rules; g_tdm_teams_override 3;        do_endmatch"
alias tdm4  "defaultsettings; tdm-rules; g_tdm_teams_override 4;        do_endmatch"

alias addvote_gametypes "addvote \"as ca ctf dm duel dom ft ka kh lms nb ons tdm\""
alias addvote_gametypes_t "addvote \"ca3 ca4 ft3 ft4 kh2 kh4 tdm3 tdm4\""

// ===========================
// player limits for gametypes
// ===========================

set _g_maxplayers 0
alias _g_maxplayers_calc "sv_cmd rpn /_g_maxplayers $1 $2 * def"
alias _g_maxplayers_set "g_maxplayers $_g_maxplayers"
alias _g_maxplayers "_g_maxplayers_calc $1 $2; _g_maxplayers_set"
// alias for 2 teams
alias _add_alias_NvN_calc "alias ${2}v${2}${1} \"${1}; _g_maxplayers 2 ${2}\""
alias _add_alias_NvN "_add_alias_NvN_calc $1 6; _add_alias_NvN_calc $1 5; _add_alias_NvN_calc $1 4; _add_alias_NvN_calc $1 3; _add_alias_NvN_calc $1 2"
// alias for 3,4 teams
alias _add_alias_NvN_t_calc "alias ${2}v${2}${1}${3} \"${1}${3}; _g_maxplayers ${3} ${2}\""
alias _add_alias_NvN_t3 "_add_alias_NvN_t_calc $1 5 3; _add_alias_NvN_t_calc $1 4 3; _add_alias_NvN_t_calc $1 3 3; _add_alias_NvN_t_calc $1 2 3"
alias _add_alias_NvN_t4 "_add_alias_NvN_t_calc $1 4 4; _add_alias_NvN_t_calc $1 3 4; _add_alias_NvN_t_calc $1 2 4"
alias _add_alias_NvN_t "_add_alias_NvN_t4 $1; _add_alias_NvN_t3 $1"
// --- keyhunt specific ---
// alias for 3 teams
alias _add_alias_NvN_kh_calc "alias ${1}v${1}kh \"kh; _g_maxplayers 3 $1; do_endmatch\""
alias _add_alias_NvN_kh "_add_alias_NvN_kh_calc 5; _add_alias_NvN_kh_calc 4; _add_alias_NvN_kh_calc 3; _add_alias_NvN_kh_calc 2"
// alias for 2,4 teams
alias _add_alias_NvN_kh_t2 "_add_alias_NvN_t_calc kh 6 2; _add_alias_NvN_t_calc kh 5 2; _add_alias_NvN_t_calc kh 4 2; _add_alias_NvN_t_calc kh 3 2; _add_alias_NvN_t_calc kh 2 2"
alias _add_alias_NvN_kh_t "_add_alias_NvN_t4 kh; _add_alias_NvN_kh_t2"

_add_alias_NvN as; _add_alias_NvN ca; _add_alias_NvN ctf; _add_alias_NvN dom; _add_alias_NvN ft; _add_alias_NvN_kh; _add_alias_NvN nb; _add_alias_NvN ons; _add_alias_NvN tdm
_add_alias_NvN_t ca; _add_alias_NvN_t ft; _add_alias_NvN_kh_t; _add_alias_NvN_t tdm

// overwrite gametype rules for specific player limits
//alias 2v2tdm "tdm; _g_maxplayers 2 2; timelimit_override 15"

alias addvote_gametypes_players   "addvote \"2v2as 3v3as 4v4as 5v5as 6v6as 2v2ca 3v3ca 4v4ca 5v5ca 6v6ca 2v2ctf 3v3ctf 4v4ctf 5v5ctf 6v6ctf 2v2dom 3v3dom 4v4dom 5v5dom 6v6dom 2v2ft 3v3ft 4v4ft 5v5ft 6v6ft 2v2kh 3v3kh 4v4kh 5v5kh 2v2nb 3v3nb 4v4nb 5v5nb 6v6nb 2v2ons 3v3ons 4v4ons 5v5ons 6v6ons 2v2tdm 3v3tdm 4v4tdm 5v5tdm 6v6tdm\""
alias addvote_gametypes_t_players "addvote \"2v2ca3 3v3ca3 4v4ca3 5v5ca3 2v2ca4 3v3ca4 4v4ca4 2v2ft3 3v3ft3 4v4ft3 5v5ft3 2v2ft4 3v3ft4 4v4ft4 2v2kh2 3v3kh2 4v4kh2 5v5kh2 6v6kh2 2v2kh4 3v3kh4 4v4kh4 2v2tdm3 3v3tdm3 4v4tdm3 5v5tdm3 2v2tdm4 3v3tdm4 4v4tdm4\""

// ========
// mutators
// ========

alias _info_message "defer 4 \"say ^3${1} enabled - to disable ${1} vote for a gametype^7\""

alias _hook         "toggle g_grappling_hook; g_jetpack 0; toggle g_balance_hook_weaponstart"
alias _jetpack      "toggle g_jetpack; g_grappling_hook 0; toggle g_balance_hook_weaponstart"
alias _instagib     "toggle g_instagib; g_balance_vaporizer_weaponthrowable 1"
alias _weaponarena  "toggle g_weaponarena \"most\" \"0\""
alias _overkill     "exec mutator_overkill.cfg"
alias _mutators_disable "exec mutators_disable.cfg"

alias _nomutators      "g_weaponarena 0; _mutators_disable; _balance_xonotic; _physics_xonotic"

alias hook             "_nomutators; _hook;                            do_restart; _info_message hook"
alias jetpack          "_nomutators; _jetpack;                         do_restart; _info_message jetpack"
alias weaponarena      "_nomutators; _weaponarena;                     do_restart; _info_message weaponarena"
alias hookarena        "_nomutators; _weaponarena; _hook;              do_restart; _info_message hookarena"
alias jetpackarena     "_nomutators; _weaponarena; _jetpack;           do_restart; _info_message jetpackarena"
alias instagib         "_nomutators; _instagib;                        do_restart; _info_message instagib"
alias instahook        "_nomutators; _instagib; _hook;                 do_restart; _info_message instahook"
alias instajetpack     "_nomutators; _instagib; _jetpack;              do_restart; _info_message instajetpack"
alias infammo_enable   "g_use_ammunition 0;                            do_restart"
alias infammo_disable  "g_use_ammunition 1;                            do_restart"
alias overkill         "_nomutators; _overkill;                        do_restart; _info_message overkill"

//alias addvote_mutators "addvote \"hook hookarena jetpack jetpackarena instagib instahook instajetpack overkill weaponarena\""
alias addvote_mutators "addvote \"instagib instahook overkill weaponarena\""

// ======
// others
// ======

alias sv_hook_gamestart_all "exec configs/matrix.cfg; echo Map: ${sv_worldbasename}"
alias sv_hook_gameend "say ^8Game over. Thanks for playing, we hope you enjoyed ${sv_worldbasename}!"

alias warmup_toggle "toggle g_warmup; do_restart"
alias enablebots "minplayers 2"
alias nobots "minplayers 0"
alias enemyspec_enable "g_ca_spectate_enemies 1"
alias enemyspec_disable "g_ca_spectate_enemies 0"
alias spectatorchat_enable "g_chat_nospectators 0"
alias spectatorchat_disable "g_chat_nospectators 2"

alias addvote_others "addvote \"enemyspec_enable enemyspec_disable spectatorchat_enable spectatorchat_disable warmup_toggle enablebots nobots\""

// ==============
// model settings
// ==============

// !!! ATTENTION: !!!
// if you force a default model, then client cvars "cl_forceplayer..." are repealed

set _sv_defaultplayermodel "models/player/megaerebus.iqm"

alias fbskin_model_forcedefaults "sv_defaultcharacter 1; sv_defaultplayerskin 1; sv_defaultplayermodel ${_sv_defaultplayermodel}"
alias sv_fbskin_red     "fbskin_model_forcedefaults; sv_defaultplayercolors 68"
alias sv_fbskin_green   "fbskin_model_forcedefaults; sv_defaultplayercolors 51"
alias sv_fbskin_blue    "fbskin_model_forcedefaults; sv_defaultplayercolors 221"
alias sv_fbskin_yellow  "fbskin_model_forcedefaults; sv_defaultplayercolors 204"
alias sv_fbskin_orange  "fbskin_model_forcedefaults; sv_defaultplayercolors 238"
alias sv_fbskin_white   "fbskin_model_forcedefaults; sv_defaultplayercolors 00"
alias sv_fbskin_rainbow "fbskin_model_forcedefaults; sv_defaultplayercolors 47"
alias sv_fbskin_unique  "fbskin_model_forcedefaults; sv_defaultplayercolors \"\""

alias addvote_forceskins "addvote \"sv_fbskin_blue sv_fbskin_green sv_fbskin_orange sv_fbskin_red sv_fbskin_white sv_fbskin_yellow sv_fbskin_unique sv_fbskin_rainbow sv_fbskin_off\""


// ==========
//  override
// ==========

// alias
alias _balance_xonotic   "exec balance-xonotic.cfg; g_balance_shotgun_weaponreplace machinegun; g_spawn_furthest 1"
alias _balance_xpm       "exec balance-xpm.cfg; g_balance_shotgun_weaponreplace machinegun; g_spawn_furthest 1"
alias balance_xonotic    "_balance_xonotic; do_restart"
alias balance_xpm        "_balance_xpm;  do_restart"

// maplists

set _maplist_ca 	"cucumber_v2 luminar mint curvature_02 farewell afterslime stormkeep xoylent overkill atelier new-station_r1 campgrounds_beta4 battleforged_full_r2 dreadfulplace_v1 cpm27_nex_r1 azalea peasants_palace sinister_full_r2 breath_b7 sewers aneurysm_itemfix chronic hiddenfortress_full_r1 q2warehouse asylum_full_r1 atomforge bloodrun_a3 pluvial_test3 downward_b3 fatalinstinct_full_r1 shdwdm1 ospdm5_nex_r2 devilish_full_r1 finalrage kwadraty_v1r1 crystalcave deadanggone_full_r1 henhouse_full_r1 jaxdm8 rota3dm3 runningmanctf silentsiege solace_b6 subhumandm1 thunderstruck_full_r1 verticalvengean_full_r2 cliffside_full_r1"
set _maplist_ctf	"controlfactor_v3 cb_ctf4_v1r1 attic apace moonstone_nex_r3 mIKEctf2_nex_r3 catharsis abyss city_crossings_q3w7 spiderctf-v3 geoplanetary tarx runningmanctf accident_v3 ctctf6_nex_r2 astralcity"
set _maplist_ctf2v2	"dance dm_castle go hydroxon tarx implosion skycastle vinegar_beta3 disarray_v1r2 bluez_vs_redz trance equinox runningmanctf recratemini dreamscape_r1"
set _maplist_ctf3v3	"disarray_v1r2 ctctf6_nex_r2 bloodprisonctf runningmanctf vorix dm_castle bluez_vs_redz spatium-a4 distortion-v3-r3 implosion hydroxon geoplanetary tarx"
set _maplist_duel 	"cucumber_v2 erbium luminar mint cure_full_r3 silence_full_r3 sinister_full_r2 battleforged_full_r2 hektik_r1 hub3aeroq3a_nex_r4 fuse stormkeep finalrage bloodrun_a3 warfare silentsiege xoylent downer_final_r1 toxicity darkzone_qw_b2 opium_v4 imprisoned-final_r3 aggressorx fe26 drain pluvial_test3 syntheticv1 ruinerx campgrounds_beta4 farewell dismemberment_xon_a1 crystalcave lostworld lethargy bloodprison_xon_r2 azalea revtourney1 industrial_nex_r1 metalmaze atomforge runningman solace_b6 heart_v2 curvature_02 styrofoam zenith fisume_v2 clockwork_v001 furiousheights_b2 houseofdecay_full_r2 verticalvengean_full_r2"
set _maplist_tdm	"dreadfulplace_v1 atelier monstrosity_a3r1 ospdm5_nex_r2 bromine rush_b1 grudge voll_aufs_maul_v4 afterslime breath_b7 ospdm1_nex_r2 sewers ludicrous_r3 strength vociferous_alpha"
set _maplist_tdm2v2	"stormkeep finalrage xoylent breath_b7 opium_v4 ospdm5_nex_r2 atomforge minigrudge silentsiege pluvial_test3 bloodrun_a3 sinister_full_r2 campgrounds_beta4 furiousheights_b2 kwadraty_v1r1 new-station_r1 imprisoned-final_r3 battleforged_full_r2 devilish_full_r1 metalmaze solace_b6"

// overwrite gametype rules
alias defaultsettings   "_nomutators; _defaultteams; _defaultlimits; enablebots; g_maxplayers 0; g_powerups -1; sv_taunt 1; teamplay_mode 2; g_maplist \"$_maplist_default\""

alias ca-rules          "gametype ca;	timelimit_override 0; g_powerups 0; teamplay_mode 1; _arc_disable; g_maplist \"$_maplist_ca\""
alias ctf-rules         "gametype ctf;	fraglimit_override 10; g_maplist \"$_maplist_ctf\""
alias duel-rules        "gametype dm;	g_warmup 1; fraglimit_override 0; timelimit_override 10; g_maxplayers 2; g_powerups 0; sv_taunt 0; g_maplist \"$_maplist_duel\"; _balance_xpm"
alias lms-rules         "gametype lms;	timelimit_override 0; g_powerups 0; teamplay_mode 1; _arc_disable"
alias tdm-rules         "gametype tdm;	g_tdm_point_leadlimit 40; g_tdm_point_limit 0; g_maplist \"$_maplist_tdm\"; _balance_xpm"

// overwrite gametype rules for specific player limits
alias 2v2ctf "ctf; g_maxplayers 4; timelimit_override 10; capturelimit_override 7; g_maplist \"$_maplist_ctf2v2\""
alias 3v3ctf "ctf; g_maxplayers 6; g_maplist \"$_maplist_ctf3v3\""
alias 2v2tdm "tdm; g_maxplayers 4; g_tdm_point_leadlimit 30; timelimit_override 15; g_maplist \"$_maplist_tdm2v2\"; do_endmatch"
